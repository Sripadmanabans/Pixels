plugins {
  id "com.adjectivemonk2.jvm.lib"
  id "org.jetbrains.compose"
}

compileKotlin {
  kotlinOptions {
    if (project.findProperty("pixels.enableComposeCompilerReports") == "true") {
      freeCompilerArgs += [
        "-P",
        "plugin:androidx.compose.compiler.plugins.kotlin:reportsDestination=" +
          buildDir.absolutePath + "/compose_metrics"
      ]
      freeCompilerArgs += [
        "-P",
        "plugin:androidx.compose.compiler.plugins.kotlin:metricsDestination=" +
          buildDir.absolutePath + "/compose_metrics"
      ]
    }
  }
}

def kotlinVersion = libs.versions.kotlin.get()
def composeKotlinVersion = libs.versions.composeJetbrainsKotlin.get()
def suppressComposeCompatibility = kotlinVersion != composeKotlinVersion

if (suppressComposeCompatibility) {
  println("Suppressing jvm library level compiler kotlin compiler check was $kotlinVersion require $composeKotlinVersion!!")
  compose {
    kotlinCompilerPlugin.set(libs.androidx.compose.compiler.get().toString())
    kotlinCompilerPluginArgs.add("suppressKotlinVersionCompatibilityCheck=$kotlinVersion")
  }
}

dependencies {
  implementation libs.jetbrains.compose.runtime
}
