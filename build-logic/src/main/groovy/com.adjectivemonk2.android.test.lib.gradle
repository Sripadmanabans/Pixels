plugins {
  id "com.adjectivemonk2.android.lib"
  id "de.mannodermaus.android-junit5"
}

android {
  defaultConfig {
    testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"

    // The following argument makes the Android Test Orchestrator run its
    // "pm clear" command after each test invocation. This command ensures
    // that the app's state is completely cleared between tests.
    testInstrumentationRunnerArguments clearPackageData: "true"
    // Connect JUnit 5 to the runner
    testInstrumentationRunnerArguments runnerBuilder: "de.mannodermaus.junit5.AndroidJUnit5Builder"
  }

  testOptions {
    unitTests {
      returnDefaultValues = true
      includeAndroidResources = true
    }
    unitTests.all { useJUnitPlatform() }
  }
}

dependencies {
  implementation libs.androidx.tracing

  androidTestImplementation libs.androidx.test.espresso.core
  androidTestRuntimeOnly libs.androidx.test.runner

  androidTestImplementation libs.junit5.android.core
  androidTestRuntimeOnly libs.junit5.android.runner

  androidTestImplementation libs.junit5.jupiter.api
  androidTestRuntimeOnly libs.junit5.jupiter.runtime

  androidTestUtil libs.androidx.test.orchestrator
}

// TODO same thing for instrumentation tests: https://issuetracker.google.com/issues/37056080
//tasks.withType(AndroidTestTask) {
//  testLogging {
//    events "skipped", "failed", "passed"
//  }
//}
